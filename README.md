# KaitenGitlabIntegration
  После загрузки расширения в браузер (из магазина или вручную) 
  для корректной работы расширения необходимо заполнить 
  все поля в окне расширения (токены и ссылки).

  ## Kaiten
    1. Блок "Gitlab" создается в карточке задачи.
      Данный блок содержит:
        1.1. Строка веток - состоит из:
          1.1.1. информационной кнопки с указанием количества найденных (по CARD_ID и ссылкам в карточке) веток *.
          1.1.2. кнопки создания новой ветки (+).
        1.2. Строка merge-запросов
          1.2.1. информационной кнопки с указанием количества найденных (по CARD_ID и ссылкам в карточке) merge-запросов *.
          1.2.2. кнопки создания новой ветки (+).
          
        * - данные методы поиска используют еще и project_id, который получается следующим образом:
          1) анализируются ссылки в карточке (external_links)
          2) если ссылка является ссылкой на Gitlab, то из нее получаем project_path + branch_name или merge-request id в зависимости от типа ссылки
          3) далее ищем проекты по полученному project_path и результаты фильтруем по строгому равенству project.path === project_path
          4) далее по полученным проектам производим поиск требуемых сущностей

    2. Модальное окно создания ветки (открывается при нажатии на кнопку 1.1.2)
      Для создания ветки необходимо выбрать проект и исходную ветку из выпадающих списков.
      Название новой ветки вводится вручную и должно содержать номер (id) карточки для корректной работы расширения.
      Тип новой ветки выбираем из выпадающего списка для соответствующего префикса у названия новой ветки,
        если префикс не требуется - выбираем тип "Custom".

    3. Модальное окно создания merge-запроса (открывается при нажатии на кнопку 1.2.2)
      Для создания merge-запроса необходимо выбрать проект, исходную и целевую ветку из выпадающих списков.
      Поля "Проверяющий" и "Ответственный" являются опциональными.
      Название нового merge-запроса вводится вручную и должно содержать номер (id) карточки для корректной работы расширения.

    4. Модальное окно список веток (открывается при нажатии на кнопку 1.1.1)
      Содержит список веток найденных по проектам из пункта 1.1.1* и CARD_ID.
      Ячейки в столбцах "Хранилище" и "Ветка" являются ссылками на данные сущности в Gitlab. 

    5. Модальное окно список merge-запросов (открывается при нажатии на кнопку 1.2.1)
      Содержит список merge-запросов найденных по проектам из пункта 1.2.1* и CARD_ID.
      Ячейки в столбцах "Хранилище" и "Merge Request" являются ссылками на данные сущности в Gitlab. 
      В столбце "Состояние" отображается state merge-запроса.

  ## Gitlab
    1. Ссылки на карточки в Kaiten добавляются в следующих областях:
      1.1. Список веток (каждый элемент списка)
      1.2. Список Merge Requests (каждый элемент списка)
      1.3. Экран Merge Request (название исходной ветки под заголовком Merge Request)
      1.4. Экран Files (селектор выбора ветки)
      1.5. Экран Commits (селектор выбора ветки)

    2. Ссылка генерируется относительно названия сущности - из названия получается 7-8 значное число и считается id карточки в Kaiten,
      если такое число в названии не найдено - ссылка не создается.

## Getting started

1. npm install
2. npm run build
3. "/dist" - directory with extension for upload

## Precommit

1. ".husky/pre-commit"
    npm run build
    git add .